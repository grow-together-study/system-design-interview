
> 어디에 얼마나 무엇으로 알람을 보낼지 생각을 해야 한다.


연성 시스템?:

1. 어떤 단말을 지원하는가?
   - IOS, 안드로이드, 랩톱/데스크톱
2. 어떤 종류의 알람인가?
   - 푸시 알림, SMS, 이메일
3. 몇건의 알람?
   ex) 천만 건의 모바일 푸시 알림, 백만 건의 SMS 메시지, 5백만 건의 이메일



ISO에서 푸시 알람을 보내기 위한 3가지 컴포넌트
- 알림 제공자
  - 알림 서비스로 보내는 주체
  - 단말 토큰
  - 페이로드 : JSON
- APNS:에플이 제공하는 원격 서비스
-ios 단말

안드로이드
- FCM: APNS 대신
- 나머진 같음

SMS 메시지
- 보통 트윌리오, 넥스모 
- 국내에서는 카톡이지 않을까?

이메일
- 센드그리드
- 메일침프
- 대부분 회사는 고유 이메일 서버를 구축할 역량은 됨
  -> 상용서비스 사용이유: 전송 성공률도 높고, 데이터 분석 서비스 재공


초안
- 1~N서비스: 마이크로 서비스 or 크론잡 or 분산 시스템 컴포넌트
  - ex) 납기일을 알리고자 하는 과금 서비스, 배송 알림을 보내려는 쇼핑몰 웹 사이트
- 알림 시스템
- 제 3자 서비스: 사용자에게 알림을 실제로 전달하는 역할
- 확장성: 쉽게 새로운 서비스를 통합하거나 기존 서비스를 제거 할 수 있어야 한다는 뜻
- 어떤 서비스는 다른 환경에서 사용이 불가 ex) 중국에서는 제이푸시 or 푸시와이등으로 이용해야 함
- 각 단말

문제점
- SPOF: 서버가 하나임
- 규모 확장성: 한 대 서비스로 푸시 알림에 관계된 모든 것을 처리
- 성능 병목: 알림을 처리하고 보내는 것은 자원이 많이 필요

개선 버전
- 데이터베이스와 캐시를 알림 시스템의 주 서버에서 분리
- 알림 서버를 증설하고 자동으로 수평적 규모 확장이 이뤄질수 있도록 
- 메시지 큐를 이용해 시스템 컴포넌트 사이의 강한 결함을 끊는다.


캐시 - 사용자 정보, 단말 정보, 알림 템플릿등 캐시
데이터베이스 - 사용자,알림,설정 다양한 정보 저장
메시지 큐 - 시스템 컴포넌트 간의 의존성 제거
작업 서버 - 메시지 큐에서 전송할 알림을 꺼내서 제 3의 서비스로 전달
제 3자 서비스
단말

조금더 신경 써야 하는 

1. 안정성
   - 데이터 손실 방지: 어떤 상황에서도 알람이 소실되면 안 된다는 것
     - 알림 데이터를 데이터베이스에 보관하고, 재시도 메커니즘을 구현해야 한다. 
   - 알림 중복 전송 방지


추가로 고려해야할...

- 알림 템플릿: 인자, 추적 링크 조정
  - 본문
  - 알림 설정
  - 전송률 제한
  - 재시도 방법
  - 푸시 알림과 보안
  - 큐 모니터링
  - 이벤트 주석
