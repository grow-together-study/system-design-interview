# 🧾 대규모 시스템 설계 스터디 회고록 – 3장

**일시:** 2025년 6월 18일 (수) 오후 9시 ~ 10시 20분

**참여자:** 박이현, 박용훈, 김호섭, 최선강

---

## ✅ 전체 흐름 요약
#### 1. 대량 알림 발송 후 유입 트래픽 대응 전략
- **문제 상황**: 푸시 알림 혹은 이벤트 메시지를 대량 발송 시, 수십만 사용자의 동시 접속으로 인한 시스템 부하 발생

- **대응 전략**:
    - 발송 측면: 점진적/배치 발송, 유휴 시간대 발송
    - 유입 측면:
        - CDN 활용 (정적 페이지)
        - 읽기 요청 캐시 처리
        - 레이트 리밋, 쓰로틀링
        - 메시지 큐 기반 요청 큐잉
        - Auto-scaling + Load Balancer 적용
        - 대기열 UI 적용 (예: "당신은 대기순번 115번입니다")

- **회고 포인트**:
    - 실무 경험에 기반한 스케일아웃 우선 전략 공감
    - CDN 사용 조건(정적 리소스)에 대한 개념 공유
    - APM 없이 병목 지점을 판단하는 것의 한계 지적

#### 2. 좋아요 시스템 설계

- **문제 상황**: 대규모 유저가 동시에 특정 게시물에 좋아요를 누를 경우, DB 부하 및 일관성 문제 발생 가능

- **설계 방향**:

    - Redis set으로 유저-게시글 중복 체크 및 카운팅

    - 메시지 큐를 통한 DB 쓰기 요청 비동기화

    - RDB에는 일정 주기 동기화

    - 좋아요 수는 Redis 캐시로 빠르게 응답

    - 조회 시 캐시 우선 조회

- **회고 포인트**:

    - JPA 대신 JPQL/Native Query 사용하여 성능 확보 필요성 인식

    - 비정규화를 통한 조회 속도 개선 사례 공유 (ex. 카카오 오픈채팅 좋아요)


#### 3. Redis는 왜 싱글스레드인데도 빠른가?

- **질문 제기**: 싱글스레드 구조인데 어떻게 높은 처리량을 달성하는가?

- **답변 요약**:

    - Redis는 **비동기 이벤트 루프 + 논블로킹 I/O** 기반

    - 멀티스레딩에서 발생하는 컨텍스트 스위칭 비용이 없음

    - 순차적 요청 처리 방식이 오히려 고속 처리에 유리한 구조

- **회고 포인트**:

    - 운영체제 관점에서의 컨텍스트 스위칭 개념과 연결 필요

    - Redis 설계 원리에 대한 더 깊은 이해 필요 (이벤트 루프 작동 방식 등)


#### 4. Kafka 브로커 구성과 메시지 처리량 튜닝

- **질문 시나리오**:

    - 메시지 크기: 평균 1MB

    - 브로커 메모리: 1GB

    - 초당 메시지 발행량: 10,000건 (총 10GB)

    - 컨슈머 처리량: 초당 1,000건

- **주요 논의 내용**:

    - 이 구성은 단일 브로커, 1GB 메모리 환경에서는 현실적으로 불가능

    - 기본적으로 Kafka는 최소 3대 이상의 브로커 클러스터 구성이 필수

    - 브로커 메모리를 올리는 것이 우선적인 조치이며, 이후에 파티셔닝, 컨슈머 스케일아웃 등의 튜닝을 적용해야 함

    - 메시지를 청크 단위로 쪼개는 방식, 발행 주기 지연 등도 추가 고려 대상

    - 컨슈머가 Spark, Flink 등 외부 프레임워크인 경우 처리 흐름이 다를 수 있다는 점 인식

    - Kafka의 메시지는 소비 이후에도 브로커 내에 보존되며, 만료 주기 설정을 통해 삭제됨

- **회고 포인트**:

    - Kafka의 기본 구성(브로커 수, 리플리케이션 구조 등)에 대한 이해 필요

    - 컨슈머와 브로커의 독립성을 이해하고, 리소스 병목 포인트를 분리해서 바라보는 훈련이 필요함

    - 단순히 throughput을 높이는 것이 아니라, 전체 파이프라인 구조를 기반으로 한 아키텍처 설계가 중요
---

## ✅ 질문 중심 회고 요약

### 박이현

**💬 질문 1**

> 많은 고객들에게 대량의 알림 발송을 하는 경우, 해당 알림을 받고 들어오는 고객들의 대량의 트래픽을 안정적으로 처리하려면 어떻게 해야할까?

**🗣 주요 논의:**

* 유입량이 예상되는 경우 스케일 아웃 전략(서버 인스턴스 사전 확장) 적용
* 정적 페이지로의 유도 시 CDN을 적극 활용할 수 있으나, 실제 동작 페이지가 정적이어야 한다는 전제 조건이 있음
* 레디스 기반 대기열, TTL 만료 처리, 웹소켓 ping/pong 기반 대기 시스템 설계 아이디어 논의
* 실시간 응답이 필요한 상황에서는 병렬 처리보단 요청 큐잉과 제한적 발행이 더 현실적인 전략

---

### 전희진

**💬 질문 1**

> 시스템 설계 면접을 실제로 해본 경험이 있으신지, 시스템 설계 면접은 어떻게 준비하는 것인지 궁금합니다.

**🗣 주요 논의:**

* 참석자 대부분 실제 면접 경험은 많지 않았으나, 책 기반으로 면접 흐름을 상상하며 준비 중
* 시나리오 기반 훈련이 유효하며, 실무 경험이 부족한 경우 추론 + 질문 중심 설계로 방어할 수 있음
* 실무 경험 없이 설계를 방어하기 위한 답변 구조 구성법에 대해 의견 공유

---

### 최선강

**💬 질문 1**

> 대량의 트래픽에서 게시물 '좋아요' 는 어떤 걸 고려하고, 어떤 시스템을 설계하는 게 좋을까요?

**🗣 주요 논의:**

* Redis set을 이용한 유저-게시글 중복 방지, 좋아요 수 캐싱 전략 제시
* Kafka를 통해 좋아요 DB 쓰기를 비동기로 처리 → 트래픽 급증 시에도 DB 부하 최소화
* 일정 시간마다 캐시된 좋아요 수를 RDB에 동기화
* 카카오 오픈채팅 좋아요 구조처럼, 비정규화를 통해 조회 성능 개선하는 방식 소개

---

## 📝 회고 및 개선 제안

* Redis, Kafka 등 개념적 이해에서 벗어나 실제 처리 흐름을 단계적으로 정리하는 훈련 필요
* 캐시, 메시지 큐, 대기열, 대용량 처리 분산 전략의 상호작용 이해 강화 필요
* 스터디 참가자 간 경험 차이를 보완하기 위해 실습 기반 사례 공유 강화 예정

---

## 🔍 보완 학습 제안

* 좋아요 수 Redis 처리 실습: 중복 방지 + 집계 + 주기적 동기화
* Kafka 기본 구조 실습: 브로커 구성, 파티션, 리텐션 설정
* Redis 이벤트 루프 내부 구조 분석
* Auto Scaling 정책 설계 실습 (CloudWatch, GCP metrics 기반 등)




