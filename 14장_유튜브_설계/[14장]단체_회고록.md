# 🧾 대규모 시스템 설계 스터디 회고록 – 14장

**일시:** 2025년 7월 30일 (수) 오후 9시 ~ 10시 30분

**참여자:** 박이현, 박용훈, 전희진


---

## ✅ 질문 중심 회고 요약

### 🧑‍💻 전희진

**💬 질문 1**

> 한국 CDN 저장소에 업로드 했다고 가정하면, 한국 업로드 후 다른 지역 CDN 전역에 파생되는 개념인가요? 아니면 CDN에 업로드 하는 행위 자체가 리전 전체에 업로드 되는 건가요?

* **초기 예상**: 모든 참여자가 처음에는 업로드 시 전 세계 리전에 동시 배포될 것으로 예상
* **실제 동작 방식 (캐시 미스 기반)**:
    * 한국에서 업로드 → 오리진 서버(한국)에만 저장
    * 미국 사용자가 처음 요청 → 오리진 서버에서 파일 가져와 미국 엣지 서버에 캐싱
    * **첫 사용자는 지연 경험** (캐시 미스 상황)
    * 이후 사용자들은 엣지 서버에서 빠르게 제공

* **Pull 방식의 이해**:
    * 요청이 들어오는 순간에 파일을 당겨옴
    * 설정된 TTL(Time To Live) 동안 엣지 서버에 캐싱 유지
    * 효율성: 사용되지 않는 지역까지 미리 배포하는 비효율 방지

* **엣지 서버 개념 정리**:
    * 오리진 서버가 아닌 각 지역의 캐시 서버
    * 사용자와 가까운 위치에서 콘텐츠 제공

* **CDN과 S3의 관계**:
    * 책에서 초기에는 S3로 시작하다가 확장 시 CDN 도입
    * CDN은 지역별 분산 캐시 저장소 개념
    * S3는 원본 저장소

---

### 🧑‍💻 박용훈

**💬 질문 1**

> 라이브 스트리밍을 만드는 경우, 기존의 스트리밍 서버와 달리 프로토콜을 다르게 해야 개발을 해야 하는걸로 알고 있습니다. 그렇다면, 어떠한 점을 유의해서 프로토콜을 선정해야 할까요?

* **VOD vs 라이브 스트리밍의 핵심 차이**:
    * **VOD (유튜브 등)**:
        - 속도보다 **정합성** 우선
        - 업로드 완료까지 1시간이든 이틀이든 문제없음
        - 한 번 업로드되면 파기(배포)만 하면 됨
    * **라이브 스트리밍**:
        - **실시간성**이 핵심
        - 바로바로 보여줘야 함
        - **가용성** 측면을 책임지는 프로토콜 필요

* **주요 라이브 스트리밍 프로토콜 4가지** (책에는 간략히만 언급):
    * **HLS (HTTP Live Streaming)**:
        - 지연시간: 10~30초
        - CDN 친화적, 높은 지연 시간
        - 대규모 방송, VOD 서비스에 적합
        - 애플이 개발 (애플 페이스타임 사용)
    * **RTMP (Real-Time Messaging Protocol)**:
        - 낮은 지연시간
        - 방송 송출용으로 주로 사용
        - 유튜브 라이브에서 사용
    * **WebRTC**: 초저지연 (1초 미만)
    * **기타**: RTMPS, RTSP 등

* **프로토콜 선택 시 고려사항**:
    * **지연시간 최소화**: 라이브의 핵심 요구사항
    * **동시 접속자 수**: 인기 방송은 수천~수만 명 동시 시청
    * **트레이드오프 고려**: 지연시간 vs 안정성 vs 확장성

* **실제 서비스 지연 경험**:
    * 아프리카TV, 치지직 등에서 5~10초 정도 지연 존재
    * 방송자가 말하는 순간과 시청자가 듣는 순간의 시간차
    * 이 지연을 최소화하는 것이 라이브 스트리밍 프로토콜의 목표

* **산업 중요성**:
    * 넷플릭스, 티빙 등 영상 스트리밍 회사 취업 시 **프로토콜 학습 필수**
    * 네트워크 지식이 핵심 역량
    * 단, 라이브 커머스는 포지션에 따라 네트워크 질문이 적을 수도 있음

---

### 🧑‍💻 박이현

**💬 질문 1**

> 비디오를 저장할 때 왜 BLOB 저장소를 쓰는 게 좋은가요?

* **BLOB의 정의**:
    * **BLOB (Binary Large Object)**: 비정형 바이너리 데이터
    * RDB에도 BLOB 데이터 타입 존재 (대용량 데이터 저장용)
    * **CLOB (Character Large OBject)**: 텍스트 데이터용

* **관계형 DB vs BLOB 저장소**:
    * **RDB의 한계**:
        - 대용량 비디오/이미지 저장에 비효율적
        - CPU, 메모리, 스토리지가 패키징되어 **불필요한 컴퓨팅 리소스 비용** 발생
        - 영상 파일로 인해 DB가 무거워지고 전체 성능 저하 위험
    * **BLOB 저장소의 장점**:
        - **순수하게 저장 용량과 네트워크 전송량에만 비용 지불**
        - **수평 확장 용이**: 스토리지 유형이므로 쉽게 확장 가능
        - 비용 효율적

* **대표적인 BLOB 저장소**: Amazon S3
* **BLOB의 정의 (상세)**: Binary Large Object - 임의의 크기의 데이터 모음

* **DB에 직접 파일 저장하는 방식 (안티패턴)**:
    * **가능은 하지만 권장하지 않음**:
        - Base64 인코딩 후 BLOB/TEXT 컬럼에 저장
        - HTML에서 디코딩하여 img src에 삽입 가능
    * **실무 경험** (박이현):
        - 첫 회사에서 S3 없이 이 방식 사용
        - 이미지를 Base64로 변환하여 DB에 저장
        - 불러올 때 디코딩하여 사용
    * **치명적 문제점**:
        - **고화질 영상 저장 불가** (용량 제한으로 잘림)
        - 썸네일 등 작은 이미지만 가능
        - DB 리소스 부담으로 **다른 기능도 영향** 받을 수 있음
        - 최악의 경우 DB 전체 다운, 장애 발생

* **파일 경로 저장도 안티패턴**:
    * NAS 경로 등을 DB에 저장하는 방식도 권장되지 않음

* **트레이드오프**:
    * **소량 데이터 (몇 개 안 됨)**: DB에 저장 가능
    * **대량 데이터**: S3 등 별도 저장소로 분리
    * 용량 커지면 DB 자체가 죽을 수 있어 분리 필수

---

## 🎯 주요 학습 포인트

### 1. CDN의 온디맨드 캐싱 메커니즘
* **예상과 다른 동작**: 전역 즉시 복제가 아닌 요청 시점 캐싱
* **첫 사용자의 희생**: 캐시 미스로 인한 지연 경험
* **효율성 우선**: 사용되지 않는 지역까지 미리 배포하지 않음
* **Pull 방식**: 요청이 들어올 때 오리진에서 파일을 가져옴

### 2. 라이브 스트리밍의 핵심 요구사항
* **실시간성**: VOD와 달리 즉각적인 전송 필요
* **지연시간 최소화**: 프로토콜 선택의 가장 중요한 기준
* **가용성**: 대규모 동시 접속자 처리
* **프로토콜 다양성**: HLS, RTMP, WebRTC 등 상황에 맞는 선택

### 3. 단일 책임 원칙 (SRP)의 실전 적용
* **DB는 구조화된 데이터만**: 트랜잭션, 관계 관리에 집중
* **BLOB 저장소는 미디어 데이터**: 대용량 파일 저장에 최적화
* **메시지 큐, 캐시 등도 분리**: 각 컴포넌트가 명확한 역할 수행
* **객체지향 SOLID 원칙**이 시스템 설계에도 적용됨

---

## 💡 실무 인사이트

### CDN 동작 원리에 대한 오해
* **대부분의 개발자 예상**: 업로드 즉시 전 세계 배포
* **실제 동작**: 요청 기반 점진적 배포
* **효율성 vs 첫 사용자 경험**: 트레이드오프 존재

### 파일 저장 방식의 진화
* **과거 (작은 서비스)**:
    - DB에 Base64 인코딩하여 직접 저장
    - 간편하지만 확장성 없음
* **현재 (확장성 필요)**:
    - S3/CDN 등 전용 저장소 활용
    - 비용 효율적이고 수평 확장 용이
* **실무 경험의 가치**: LMS 시스템에서 강의 영상을 CDN에 업로드하여 스트리밍

### 네트워크 전문성의 중요성
* **스트리밍 서비스**: 프로토콜 이해 필수
* **라이브 커머스**: 포지션에 따라 다를 수 있음
* **직무별 요구사항**: 회사와 담당 업무에 따라 필요 지식 다름

### 캐싱의 편재성
* "그놈의 캐싱, 캐싱은 빠지질 않네"
* "캐싱 안 하면 취업 못하지"
* 과제 테스트에서도 캐싱 필수
* 모든 시스템 설계에서 핵심 개념

---

## 🔄 실무 경험 공유

### Base64 인코딩 방식의 한계 (박이현)
```
1. 이미지를 Base64로 인코딩
2. DB의 BLOB/TEXT 컬럼에 저장
3. HTML에서 디코딩하여 img src에 삽입
4. 문제점: 고화질은 용량 초과로 잘림, 썸네일만 가능
```

### 게임 내 필터링 시스템 (13장 연계)
* 라이브 스트리밍 댓글 필터링도 유사한 메커니즘
* 실시간 욕설 필터링의 어려움
